# 方法（Methods）

**统计分析**  
为探讨孕妇个体特征对胎儿游离 DNA（cfDNA）中 **Y 染色体浓度** 的影响，我们构建了多元线性混合模型（mixed linear model, MLMM）。  

- **因变量（Dependent variable）**：  
  - Y 染色体浓度（连续变量，建模前经标准化处理）  

- **自变量（Independent variables）**：  
  - **孕周数（Gestational Age, GA, 周）**：连续变量，表示孕妇在抽血检测时的妊娠周数  
  - **孕妇体质指数（Body Mass Index, BMI, kg/m²）**：连续变量，反映孕妇的体型  
  - **孕妇年龄（Maternal Age, 岁）**：连续变量  
  - **孕周数 × BMI 交互项**：用于检验孕周与 BMI 的交互作用  

- **随机效应（Random effect）**：  
  - 孕妇代码（ID），作为分组因子，用以控制同一孕妇多次检测结果的相关性  

模型公式如下：  

\[
Y_{ij} = \beta_0 + \beta_1 \cdot GA_{ij} + \beta_2 \cdot BMI_{ij} + \beta_3 \cdot Age_{ij} + \beta_4 \cdot (GA \times BMI)_{ij} + u_i + \epsilon_{ij}
\]

其中，\(u_i \sim N(0, \sigma^2_u)\) 表示孕妇间的随机效应，\(\epsilon_{ij} \sim N(0, \sigma^2)\) 表示残差项。  

---

# 结果（Results）

**样本特征与模型拟合结果**  
共纳入 **896 次检测**，来自 **267 名孕妇**。混合效应模型的条件决定系数（conditional R²）约为 **0.80**，表明模型能够解释 **约 80% 的 Y 染色体浓度变异**。  

各固定效应的回归系数解释如下（均基于标准化数据）：  

- **孕周数（β = 0.363, P < 0.001）**  
  - 与 Y 染色体浓度显著正相关  
  - 孕周数每增加 1 个标准差，Y 浓度平均增加 0.363 个标准差  
  - 说明胎盘源 cfDNA 随妊娠进展而增加  

- **孕妇 BMI（β = -0.139, P = 0.004）**  
  - 与 Y 染色体浓度显著负相关  
  - BMI 每增加 1 个标准差，Y 浓度平均下降 0.139 个标准差  
  - 可能与稀释效应（dilution effect）有关  

- **孕周数 × BMI（β = 0.042, P = 0.036）**  
  - 交互效应显著  
  - 孕周增加时，BMI 对 Y 浓度的负向效应减弱  

- **孕妇年龄（β = -0.111, P = 0.044）**  
  - 显著负相关  
  - 高龄孕妇的 cfDNA 中 Y 浓度相对较低  

- **截距项（β = -0.046, P = 0.416）**  
  - 不显著，无解释意义  

此外，随机效应方差（Group Var = 0.765）提示不同孕妇之间存在较大的个体差异。  

---

# 讨论（Discussion）

本研究通过多元线性混合模型系统评估了孕周数、BMI 和年龄对 cfDNA 中 Y 染色体浓度的影响。结果显示：  

1. **孕周数是主要的正向预测因子**  
   - 符合生理机制，即胎盘源 cfDNA 随妊娠周数增加而逐渐升高。  

2. **孕妇 BMI 的负向效应**  
   - 可能与血浆中 cfDNA 被稀释效应（dilution effect）相关  
   - BMI 高的孕妇 cfDNA 浓度更低  

3. **孕周与 BMI 的交互作用**  
   - 提示 BMI 对 cfDNA 的影响并非固定  
   - 随孕周增加，BMI 的负向效应被部分抵消  

4. **孕妇年龄的负向影响**  
   - 高龄孕妇的胎盘功能和 cfDNA 释放模式可能存在差异  

通过引入孕妇 ID 作为随机效应，本研究有效控制了重复测量带来的个体内相关性，提高了模型的稳健性。整体拟合结果（R² ≈ 0.80）显示模型解释度较高，能够较好地刻画 Y 染色体浓度的变异来源。  

## 多元线性混合模型公式及变量解释

### 模型公式
\[
Y_{ij} = \beta_0 + \beta_1 \cdot GA_{ij} + \beta_2 \cdot BMI_{ij} + \beta_3 \cdot Age_{ij} + \beta_4 \cdot (GA \times BMI)_{ij} + u_i + \epsilon_{ij}
\]

其中：
- \(u_i \sim N(0, \sigma^2_u)\)：孕妇间的随机效应  
- \(\epsilon_{ij} \sim N(0, \sigma^2)\)：残差项  

---

### 变量解释

#### 因变量
- **\(Y_{ij}\)**  
  第 \(i\) 个孕妇在第 \(j\) 次检测中的 **Y 染色体浓度**（标准化后）。这是模型要解释和预测的核心指标。

---

#### 固定效应（Fixed effects）
- **\(\beta_0\)** —— 截距项  
  当孕周、BMI 和年龄均处于平均水平（标准化=0）时，Y 浓度的期望值。

- **\(\beta_1 \cdot GA_{ij}\)** —— 孕周数效应  
  孕周每增加 1 个标准差，Y 浓度平均变化 \(\beta_1\)。

- **\(\beta_2 \cdot BMI_{ij}\)** —— 孕妇 BMI 效应  
  BMI 每增加 1 个标准差，Y 浓度平均变化 \(\beta_2\)。

- **\(\beta_3 \cdot Age_{ij}\)** —— 孕妇年龄效应  
  年龄每增加 1 个标准差，Y 浓度平均变化 \(\beta_3\)。

- **\(\beta_4 \cdot (GA \times BMI)_{ij}\)** —— 孕周与 BMI 的交互效应  
  表示孕周对 Y 浓度的影响会随 BMI 的水平而变化，反之亦然。

---

#### 随机效应（Random effect）
- **\(u_i\)** —— 孕妇间差异  
  每位孕妇有自己的基准水平，服从 \(N(0, \sigma^2_u)\)。反映了不同孕妇之间的个体差异。

---

#### 误差项（Residual）
- **\(\epsilon_{ij}\)** —— 随机误差  
  表示同一孕妇内部、同一孕周下不可解释的波动，服从 \(N(0, \sigma^2)\)。

---

### 模型总体理解
- **固定效应 (\(\beta\))**：描述群体水平的整体趋势。  
- **随机效应 (\(u_i\))**：反映个体差异。  
- **残差 (\(\epsilon_{ij}\))**：表示随机噪声。  

该模型能够同时捕捉 **整体规律** 与 **个体差异**，是分析重复测量临床数据的合理方法。


# 1. 问题设定与符号

给定样本集合 \(\mathcal{D}=\{1,\dots,N_{\text{all}}\}\)。对每个样本 \(j\)，记  
- \(b_j\)：孕妇 BMI；  
- \(t_j\)：检测孕周（time）；  
- \(y_j\)：Y 染色体浓度；  
- \(g_j\)：GC 含量；  
- \(\text{Predict}_j\in\{0,1\}\)，\(\text{Risk}_j\in\{1,2,3\}\)；  
- \(\text{correct}_j=\mathbf{1}\{\text{Predict}_j=\text{Risk}_j\}\in\{0,1\}\)。

我们的决策变量包括：
- 4 个 BMI 切点 \(\mathbf{b}=(b_1,b_2,b_3,b_4)\)，满足 \(b_1<b_2<b_3<b_4\)，由此把 BMI 分成 \(K=5\) 组（索引 \(i=1,\dots,5\)）；
- 每组对应的检测时间窗下上界 \((\ell_i,r_i)\)（约束 \(\ell_i<r_i\)）。

令样本 \(j\) 的 BMI 组为
\[
\kappa(j;\mathbf{b})\in\{1,\dots,5\}\quad\text{（通过 4 个切点把 BMI 分箱）}.
\]

质量控制（第二轮筛选）定义布尔量 \(Q_j\in\{0,1\}\)。本工作采用“或”的放宽版本：
\[
Q_j
=
\underbrace{\Big(\mathbf{1}\{10\le t_j\le 25\}\cdot \mathbf{1}\{y_j\ge 0.04\}
+\mathbf{1}\{t_j<10\ \text{或}\ t_j>25\}\Big)}_{\text{time/Y 条件}}
\;\;\lor\;\;
\underbrace{\mathbf{1}\{0.4\le g_j\le 0.6\}}_{\text{GC 条件}}.
\]

**第一轮筛选（与 \(\ell_i,r_i\) 直接相关）**：样本 \(j\) 被纳入当且仅当
\[
\mathbf{1}\{\ell_{\kappa(j;\mathbf{b})}\le t_j\le r_{\kappa(j;\mathbf{b})}\}=1.
\]

把两轮合起来，样本 \(j\) 是否进入优化计算，等价于指示函数
\[
K_j(\mathbf{b},\boldsymbol{\ell},\mathbf{r})
=
\underbrace{\mathbf{1}\{\ell_{\kappa(j;\mathbf{b})}\le t_j\le r_{\kappa(j;\mathbf{b})}\}}_{\text{依赖 }\mathbf{b},\boldsymbol{\ell},\mathbf{r}}
\cdot
\underbrace{Q_j}_{\text{仅由数据决定}}.
\]

在被保留的样本上，定义
\[
F_1(\mathbf{b},\boldsymbol{\ell},\mathbf{r})
=\frac{\sum_{j}K_j(\mathbf{b},\boldsymbol{\ell},\mathbf{r})\cdot \text{Risk}_j}{\sum_{j}K_j(\mathbf{b},\boldsymbol{\ell},\mathbf{r})},
\quad
F_2(\mathbf{b},\boldsymbol{\ell},\mathbf{r})
=\frac{\sum_{j}K_j(\mathbf{b},\boldsymbol{\ell},\mathbf{r})\cdot \text{correct}_j}{\sum_{j}K_j(\mathbf{b},\boldsymbol{\ell},\mathbf{r})}.
\]

优化目标为
\[
\min_{\mathbf{b},\boldsymbol{\ell},\mathbf{r}}
\; \mathcal{L}(\mathbf{b},\boldsymbol{\ell},\mathbf{r})
=F_2(\mathbf{b},\boldsymbol{\ell},\mathbf{r})-F_1(\mathbf{b},\boldsymbol{\ell},\mathbf{r}).
\]
（也可以使用 \(\lvert F_2-F_1\rvert\) 或加入最小样本量约束 \(\sum_j K_j\ge N_{\min}\)。）

**关键点**：虽然后续目标的显式代数形式中没有直接出现 \(\ell_i,r_i\)，但它们通过 \(K_j(\cdot)\) **决定了参与平均的样本集合**，从而同时影响分子与分母，因此 \(\ell_i,r_i\) **确实参与并控制**目标函数的取值。

---

# 2. 为什么把 BMI 分成 5 组是合理的？

**（1）异质性与可解释性**  
NIPT 的信号质量（如 Y 浓度、有效读段比例等）与孕妇 BMI、孕周存在系统性差异。若用单一时间窗对所有 BMI 使用同一阈值，可能对某些 BMI 水平不公平（过严或过宽）。把 BMI 划成若干组，并为每组学习其最优时间窗 \([\ell_i,r_i]\)，可以捕获这种异质性，且决策规则清晰、可解释。

**（2）偏差–方差权衡（Bias–Variance Tradeoff）**  
设总样本量为 \(N\)，分成 \(K\) 组后，每组有效样本期望约为 \(N/K\)。  
- \(K\) 太小：时间窗被迫对宽泛的 BMI 区间“一刀切”，**偏差**大；  
- \(K\) 太大：每组样本过少，估计均值波动大，**方差**大，且易触发最小样本量约束。  
工程上 \(K=5\) 常作为稳健折中：既能表达 BMI 的非线性影响，又能保证各组有足够样本支撑稳定性与可解释性（并与 \(N_{\min}\) 兼容）。

**（3）实现与沟通成本**  
5 组意味着 4 个切点，规则简明、实施成本低，科研/临床沟通友好。若需要，也可对 \(K\in\{3,4,5,6,7\}\) 进行模型选择（交叉验证或留出集）来验证 5 组是“目标值与稳定性”的折中点。

---

# 3. \(\ell_i,r_i\) 如何与目标函数关联（形式化说明）

把被纳入的样本集合记为
\[
S(\mathbf{b},\boldsymbol{\ell},\mathbf{r})=\{\,j:\ K_j(\mathbf{b},\boldsymbol{\ell},\mathbf{r})=1\,\}.
\]
则
\[
F_1=\frac{\sum_{j\in S}\text{Risk}_j}{\lvert S\rvert},\qquad
F_2=\frac{\sum_{j\in S}\text{correct}_j}{\lvert S\rvert},\qquad
\mathcal{L}=F_2-F_1.
\]
显然，\(\boldsymbol{\ell},\mathbf{r}\) 通过 \(S(\cdot)\) **直接控制** \(F_1,F_2\) 的分子与分母，因此 \(\mathcal{L}\) 随 \(\boldsymbol{\ell},\mathbf{r}\) 改变。

## 离散增量（局部变化）证明

设当前纳入集合为 \(S\)，记
\[
S_c=\sum_{j\in S}\text{correct}_j,\quad
S_r=\sum_{j\in S}\text{Risk}_j,\quad
N=\lvert S\rvert,
\]
此时
\[
\mathcal{L}=\frac{S_c}{N}-\frac{S_r}{N}=\frac{S_c-S_r}{N}.
\]

**情况 A（剔除一个样本）**：  
当 \(\ell_k\) 右移或 \(r_k\) 左移，使某个 \(j\in S\) 被剔除，新集合 \(S'=S\setminus\{j\}\)。有
\[
\mathcal{L}'=\frac{S_c-\text{correct}_j}{N-1}-\frac{S_r-\text{Risk}_j}{N-1}
=\frac{S_c-S_r-(\text{correct}_j-\text{Risk}_j)}{N-1}.
\]
因此
\[
\Delta\mathcal{L}
=\mathcal{L}'-\mathcal{L}
=\frac{(S_c-S_r)-N\cdot(\text{correct}_j-\text{Risk}_j)}{N(N-1)}.
\]

**情况 B（新增一个样本）**：  
当 \(\ell_k\) 左移或 \(r_k\) 右移覆盖到某个 \(j\notin S\)，新集合 \(S''=S\cup\{j\}\)。有
\[
\Delta\mathcal{L}
=\mathcal{L}''-\mathcal{L}
=\frac{-\,(S_c-S_r)+N\cdot(\text{correct}_j-\text{Risk}_j)}{N(N+1)}.
\]

两式表明：尽管目标函数的显式形式中看不到 \(\ell_i,r_i\)，但它们通过**样本选择集的改变**（使分子与分母发生变化）从而**实质性地决定** \(\mathcal{L}\)。

---

# 4. 非光滑性与优化选择

由于 \(K_j(\cdot)\) 含有指示函数，\(\mathcal{L}(\mathbf{b},\boldsymbol{\ell},\mathbf{r})\) 是**分段常数/分段线性**的非光滑函数：当 \(\ell_i,r_i\) 不跨越任何 \(t_j\) 时，目标不变；一旦跨越某个 \(t_j\)，目标发生跳变。这解释了：
- 纯梯度法在此类问题上可能不稳定；
- 我们引入最小样本量约束 \(\sum_j K_j\ge N_{\min}\) 以防极端解；
- 可用**光滑近似**替代硬阈值以便梯度优化。例如把 \(\mathbf{1}\{t\le r\}\) 用 sigmoid \(s_\alpha(r-t)=\frac{1}{1+e^{-\alpha(r-t)}}\) 近似：
\[
\tilde K_j \approx
Q_j\cdot s_\alpha\!\big(t_j-\ell_{\kappa(j)}\big)\cdot s_\alpha\!\big(r_{\kappa(j)}-t_j\big),
\]
再以 \(\tilde K_j\) 定义 \(\tilde F_1,\tilde F_2\) 与 \(\tilde{\mathcal{L}}\) 做梯度优化；当 \(\alpha\) 增大时，\(\tilde K_j\) 逐渐逼近硬阈值选择器。


